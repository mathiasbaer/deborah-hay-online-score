<% include ../_header %>
	<section id="main">
		<script type="text/javascript">
			var layoutEditor = (function(){
				return {
					set : {
						id: <%= set.id %>,
						grid_cols: <%= set.grid_cols === 0 ? 1 : set.grid_cols %>,
						grid_rows: <%= set.grid_rows === 0 ? 1 : set.grid_rows %>,
						cell_width: <%= set.cell_width %>,
						cell_height: <%= set.cell_height %>
					},
					types : [
						<% for ( var i = 0; i < types.length; i++ ) { %>
							'<%= types[i] %>',
						<% } %>
					]
				}
			})();
		</script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
		<script type="text/javascript" src="/javascripts/ejs_production.js"></script>
		<script src="/javascripts/layout.js" type="text/javascript"></script>
		<style type="text/css">@import url('/stylesheets/layout.css');</style>
		<h1><%= set.title %></h1>
		<div id="actions">
		<form action="#"><input type="submit" value="Save"> 
			<a href="http://dhayapp.local/#set/<%= set.path %>" target="_blank">View</a> 
			<a href="/admin/sets/<%= set.id %>/edit">Edit</a> 
			<a href="/admin/sets/<%= set.id %>/delete" confirm="Delete this set?">Delete</a>
		</form></div>
		<div id="layout-editor">
			<div class="grid">
				<% for ( var i = 0, iy = 0; iy < set.grid_rows; iy++ ) { %>
					<% for ( var ix = 0; ix < set.grid_cols; ix++ ) { %>
						<% if ( grid[iy] && grid[iy][ix] ) { %>
							<% var cell = grid[iy][ix]; %>
							<div class="grid-cell"
								title="<%= cell.title %> (#<% cell.id %>), <%= cell.type %>"
								data-id="<%= cell.id %>" 
								data-x="<%= ix %>" 
								data-y="<%= iy %>"
								data-width="<%= cell.extra.width || 1 %>" 
								data-height="<%= cell.extra.height || 1 %>"
								<% if ( cell.poster ) { %>
									style="background-image:url('http://d35vpnmjdsiejq.cloudfront.net/dh/app/cells/poster/small/<%= cell.poster %>')"
								<% } %>	><div class="resize-handle ui-resizable-handle ui-resizable-se"></div></div>
						<% } else { %>
							<div class="grid-cell z-behind"
								title="Drop cells here"
								data-x="<%= ix %>" 
								data-y="<%= iy %>"
								data-width="1" 
								data-height="1"><div class="resize-handle ui-resizable-handle ui-resizable-se"></div></div>
						<% } %>
					<% } %>
				<% } %>
				<% if ( set.grid_rows === 0 || set.grid_cols === 0 ) { %>
					<div class="grid-cell z-behind"
								title="Drop cells here"
								data-x="0" 
								data-y="0"
								data-width="1" 
								data-height="1"><div class="resize-handle ui-resizable-handle ui-resizable-se"></div></div>
				<% } %>
				<div class="add-col cell-adder"></div>
				<div class="add-row cell-adder"></div>
			</div>
		</div>
		<div id="cells">
			<div class="filters">Filters go here ...</div>
			<% include ../cells/_list %>
		</div>
	</section>
<% include ../_footer %>